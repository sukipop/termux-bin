#!/usr/bin/env zsh
script_name="$(basename $0)"
requirements=()
argument=""
option=""

# Function to display help message
function print_usage {
    print "Usage: $script_name [options]"
    print
    print "Zsh script template."
    print
    print "Arguments:"
    print "  <argument>      Some argument."
    print
    print "Options:"
    print "  -h, --help      Display this help message."
    print "  -o, --option <value>"
    print "                  Some option."
    print
}

# Function to print error message
function error {
    local message="${1:-Unknown error}"
    local color="${COLOR_RED:-#ff0000}"
    print -P "%B%F{$color}Error%f:%b $message" >&2
}

# Function to check for required packages
function pkg_check {
    local missing_pkgs=()
    for pkg in "${requirements[@]}"; do
        if ! command -v "$pkg" &> /dev/null; then
            missing_pkgs+=("$pkg")
        fi
    done
    if [[ "${#missing_pkgs[@]}" -gt 0 ]]; then
        error "Missing packages: ${missing_pkgs[@]}"
        return 1
    fi
}

# Ensure required packages are accessible
if [[ "${#requirements[@]}" -gt 0 ]]; then
    pkg_check || exit 1
fi

# Get some help
if [[ "$#" -eq 0 ]]; then
    print_usage
    exit 1
fi

# Parse arguments
while [[ "$#" -gt 0 ]]; do
    case "$1" in
        -h|--help|--help-all|-help|help)
            print_usage
            exit 0
            ;;
        -o|--option)
            if [[ -z "$2" || "$2" == -* ]]; then
                error "Missing value for $1"
                print_usage
                exit 1
            fi
            option="$2"
            shift
            ;;
        -*)
            error "Unknown option: $1"
            print_usage
            exit 1
            ;;
        *)
            if [[ -n "$argument" ]]; then
                error "Unknown argument: $1"
                print_usage
                exit 1
            fi
            argument="$1"
            ;;
    esac
    shift
done
